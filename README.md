# CodeCraft2020
2020年华为软件精英挑战赛  
队名：Z的绝对值  
成绩：粤港澳赛区初赛第二，复赛A榜第四

## 要点
### 输入
- mmap多线程读入数据，读入时保存顶点的相应字符串
- 使用多线程快排+归并排序代替快排所有输入数据
- 用类似于前向星的结构代替二维数组存图

### 找环
- 分为逆图找3层`iterationInv`和正图找4层`iteration`  
- 使用时间戳标记存有路径的点减少擦除次数，详见`mark_array`
- 增加数据结构的局部性，详见`StackMapInfo`
- 插排代替快排
- 递归展开成for循环
- 用线程池调度代替直接分块或者交叉调度
- 用线程私有变量或者CacheLine大小的结构体防止伪共享

### 输出
- 根据环数分成相对均匀的转字符串任务
- 利用查表代替手动转字符串
- 循环展开，详见`int2strThread`

## 潜在优化点
- id较小时可以用数组做离散化
- 线程池的任务调度部分可以用`atomic`的特性减少比较次数，如`compare_exchange_weak`换成`for (id_t id = atomic_id++; id < id_max; id = atomic_id++)`
- 找环的时候可以单独开一个线程转字符串
- 大佬说`memcpy`可以每次复制16B，下次复制时将多余的覆盖即可。似乎是利用了`memcpy`的特性：对于8B的倍数每次memcpy会直接复制8B，否则每次1B。
- 转字符串写到找环算法部分，但这个需要固定大小的缓冲区，为了防止RE就没用。（结果最后五发WAhhh）